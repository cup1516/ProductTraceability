<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.pt.ptdealerorder.mapper.SystemMyOrderMapper">
  <resultMap id="BaseResultMap" type="com.pt.ptdealerorder.entity.SystemOrder">
    <!--@mbg.generated-->
    <!--@Table system_order-->
    <id column="order_id" property="orderId" />
    <result column="seller_id" property="sellerId" />
    <result column="seller_name" property="sellerName" />
    <result column="buyer_id" property="buyerId" />
    <result column="buyer_name" property="buyerName" />
    <result column="product_id" property="productId" />
    <result column="product_batch" property="productBatch" />
    <result column="product_name" property="productName" />
    <result column="product_amount" property="productAmount" />
    <result column="product_price" property="productPrice" />
    <result column="product_total" property="productTotal" />
    <result column="creator_id" property="creatorId" />
    <result column="creator_name" property="creatorName" />
    <result column="create_time" property="createTime" />
    <result column="reviewer_id" property="reviewerId" />
    <result column="reviewer_name" property="reviewerName" />
    <result column="reviewer_suggestions" property="reviewerSuggestions" />
    <result column="review_time" property="reviewTime" />
    <result column="checker_id" property="checkerId" />
    <result column="checker_name" property="checkerName" />
    <result column="checker_suggestions" property="checkerSuggestions" />
    <result column="check_time" property="checkTime" />
    <result column="next_id" property="nextId" />
    <result column="previous_id" property="previousId" />
    <result column="check_flag" property="checkFlag" />
    <result column="del_flag" property="delFlag" />
    <result column="check_status" property="checkStatus" />
  </resultMap>
  <sql id="Base_Column_List">
    <!--@mbg.generated-->
    order_id, seller_id, seller_name, buyer_id, buyer_name, product_id,product_batch,product_name,
    product_amount, product_price, product_total, creator_id, creator_name, create_time,
    reviewer_id, reviewer_name, reviewer_suggestions, review_time, checker_id, checker_name,
    checker_suggestions, check_time, next_id, previous_id, check_flag, del_flag, check_status
  </sql>
    <sql id="selectSystemOrder">
			select
			<include refid="Base_Column_List"/>
			from system_order
    </sql>
    <select id="getSystemOrderPage" resultMap="BaseResultMap">
        <include refid="selectSystemOrder"/>
        where seller_id =#{companyId} and creator_id = #{userId} and del_flag = '0' and isnull(next_id)
        <if test="systemOrder.orderId != null and systemOrder.orderId != ''">
            AND order_id like concat('%', #{systemOrder.orderId}, '%')
        </if>
        <if test="systemOrder.buyerId != null and systemOrder.buyerId != ''">
            AND buyer_id  = #{systemOrder.buyerId}
        </if>
        <if test="systemOrder.productBatch != null and systemOrder.productBatch != ''">
            AND product_batch like concat('%', #{systemOrder.productBatch}, '%')
        </if>
        <if test="systemOrder.productId != null and systemOrder.productId != ''">
            AND product_id  = #{systemOrder.productId}
        </if>
        <if test="systemOrder.reviewerId != null and systemOrder.reviewerId != ''">
            AND reviewer_id  = #{systemOrder.reviewerId}
        </if>
        <if test="systemOrder.checkFlag != null and systemOrder.checkFlag != ''">
            AND check_flag  = #{systemOrder.checkFlag}
        </if>
        ORDER BY create_time DESC
    </select>

  <insert id="insertOrder" keyProperty="orderId">
      insert into system_order(
      <if test="orderId != null and orderId != ''">order_id,</if>
      <if test="sellerId != null and sellerId != ''">seller_id,</if>
      <if test="sellerName != null and sellerName != ''">seller_name,</if>
      <if test="buyerId != null and buyerId != ''">buyer_id,</if>
      <if test="buyerName != null and buyerName != ''">buyer_name,</if>
      <if test="productId != null and productId != ''">product_id,</if>
      <if test="productName != null and productName != ''">product_name,</if>
      <if test="productBatch != null and productBatch != ''">product_batch,</if>
      <if test="productAmount != null">product_amount,</if>
      <if test="productPrice != null">product_price,</if>
      <if test="productTotal != null">product_total,</if>
      <if test="creatorId != null and creatorId != ''">creator_id,</if>
      <if test="creatorName != null and creatorName != ''">creator_name,</if>
      <if test="reviewerId != null and reviewerId != ''">reviewer_id,</if>
      <if test="reviewerName != null and reviewerName != ''">reviewer_name,</if>
      <if test="nextId != null and nextId != ''">next_id,</if>
      <if test="previousId != null and previousId != ''">previous_id,</if>
      create_time
      )values(
    <if test="orderId != null and orderId != ''">#{orderId},</if>
    <if test="sellerId != null and sellerId != ''">#{sellerId},</if>
    <if test="sellerName != null and sellerName != ''">#{sellerName},</if>
    <if test="buyerId != null and buyerId != ''">#{buyerId},</if>
    <if test="buyerName != null and buyerName != ''">#{buyerName},</if>
    <if test="productId != null and productId != ''">#{productId},</if>
    <if test="productName != null and productName != ''">#{productName},</if>
    <if test="productBatch != null and productBatch != ''">#{productBatch},</if>
    <if test="productAmount != null">#{productAmount},</if>
    <if test="productPrice != null">#{productPrice},</if>
    <if test="productTotal != null">#{productTotal},</if>
    <if test="creatorId != null and creatorId != ''">#{creatorId},</if>
    <if test="creatorName != null and creatorName != ''">#{creatorName},</if>
    <if test="reviewerId != null and reviewerId != ''">#{reviewerId},</if>
    <if test="reviewerName != null and reviewerName != ''">#{reviewerName},</if>
    <if test="nextId != null and nextId != ''">#{nextId},</if>
    <if test="previousId != null and previousId != ''">#{previousId},</if>
      sysdate()
      )
  </insert>

  <select id="selectOrderById" resultMap="BaseResultMap">
      <include refid="selectSystemOrder"/>
      where order_id = #{orderId}
  </select>

  <update id="deleteOrderByIds">
      update system_order set del_flag = '1' where  order_id in
      <foreach collection="orderIds" item="orderId" open="(" separator="," close=")">
          #{orderId,jdbcType=VARCHAR}
      </foreach>
  </update>

  <update id="changeCheckFlag">
      update system_order
      <set>
          check_flag= #{systemOrder.checkFlag}
      </set>
      where order_id = #{systemOrder.orderId}
  </update>

  <update id="updateCorrelatedIds">
      update system_order
      <set>
          <if test="systemOrder.previousId != null and systemOrder.previousId != ''">previous_id = #{systemOrder.previousId},</if>
          <if test="systemOrder.nextId != null and systemOrder.nextId != ''">next_id = #{systemOrder.nextId},</if>
      </set>
      where order_id = #{systemOrder.orderId}
  </update>
</mapper>
